<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="Jotaro Shigeyama" content="">
    <title>Jotaro's Portfolio Website</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"
        integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    <link rel="stylesheet" href="https://jotaros.github.io/css/prism.css">
    
    <link rel="stylesheet" href="https://jotaros.github.io/css/custom.css">
    

    <script type="text/javascript" src="https://jotaros.github.io/js/prism.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Alegreya+Sans:300 " rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+JP" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500&display=swap" rel="stylesheet">


    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-132972254-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'UA-132972254-1');
    </script>

</head>

<body>
    <div class="container">
        
        <nav class="navbar navbar-toggleable-md navbar-light bg-faded">
            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
                data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a class="navbar-brand" href="https://jotaros.github.io/">Jotaro Shigeyama</a>

            <div class="collapse navbar-collapse " id="navbarSupportedContent">
                <ul class="navbar-nav ml-auto" id="navigator">
                    <li class="nav-item">
                        <a class="nav-link" href="https://jotaros.github.io/">Home
                            <span class="sr-only">(current)</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://jotaros.github.io/post">Blog</a>
                    </li>

                    

                </ul>
            </div>
        </nav>

<div id="container-single">
    <h1>Unityで対話型音声認識アプリを作れるフレームワークをつくった</h1>
    <h2 id="date-content">-Tue, Jan 12, 2021-</h2>
    

<blockquote>
<p>macOS, Windows両方で動く、Unityで対話型の音声認識アプリがすぐに作れるフレームワークを作りました。</p>
</blockquote>

<p><strong>Downloads</strong></p>

<p>リポジトリへのリンク：<a href="https://github.com/HassoPlattnerInstituteHCI/SpeechIOForUnity" target="_blank">https://github.com/HassoPlattnerInstituteHCI/SpeechIOForUnity</a></p>

<p>Unity Package: <a href="https://github.com/HassoPlattnerInstituteHCI/SpeechIOForUnity/releases/tag/v1.0" target="_blank">https://github.com/HassoPlattnerInstituteHCI/SpeechIOForUnity/releases/tag/v1.0</a></p>

<h2 id="つかいかた">つかいかた</h2>

<p><strong><code>SpeechOut/SpeechIn</code>を宣言し、以下のように書くだけ。</strong>
<pre>
<code class="language-cs">
SpeechOut speechOut = new SpeechOut();
SpeechIn  speechIn  = new SpeechIn(OnRecognized);</p>

<p>void Start(){
    Dialog();
}</p>

<p>async void Dialog(){
    await speechOut.Speak(&ldquo;Hello!&rdquo;);
    await speechIn.Listen(new string[] { &ldquo;Hello&rdquo;, &ldquo;Hi&rdquo;, &ldquo;Hey&rdquo; });
    await speechOut.Speak(&ldquo;How are you doing?&rdquo;);
    await speechIn.Listen(new string[] { &ldquo;I&rsquo;m fine&rdquo;, &ldquo;Nah&rdquo;, &ldquo;I&rsquo;m Sick&rdquo; });</p>

<p>}
</code>
</pre></p>

<h2 id="なぜつくったか">なぜつくったか</h2>

<p>macOS, Windowsを使う学生のために、Unityを扱う授業で音声認識を使った対話型アプリを作るためのフレームワークがあればいいなと思ったので作りました。
主に非同期処理の<code>async/await</code>ベースで、逐次処理をわかりやすく書けるように、また速度や”間”などのチューニングも簡単にできるようにしました。</p>

<p>授業ではmac, Windowsそれぞれを使う学生を同様に対応しないといけないのですが、Unityそのものは双方で動作する一方、ネイティブOSの機能を使おうとすると相互にコードを共有できない＝他のチームやグループが作ったアプリを動作させられないことになるので、このようなコードを作りました。</p>

<p>授業のためとはいえ、一般的に使いやすいツールだと思います。</p>

<h2 id="osネイティブの音声認識-音声合成">OSネイティブの音声認識・音声合成</h2>

<h3 id="macos側">macOS側</h3>

<p>macOSネイティブのオフライン音声認識ツールとしては、<code>NSSpeechRecognizer</code>が、音声合成ツールとしては、コマンドラインツールとして<code>say</code>があります。このうち、<code>say</code>に関してはUnity上の<code>System.Diagnostics.Process</code>から呼び出すことで実行できます（この点、Argsをいじるだけで声質とか速度を変えられるのでサイコー）</p>

<p>一方の<code>NSSpeechRecognizer</code>はOSネイティブAPIとして提供されている機能なので、実行するためには<code>Objective-C</code>もしくは<code>Swift</code>で記述されたコードから実行する必要があります。</p>

<p>今回のフレームワークでは別途<a href="https://github.com/HassoPlattnerInstituteHCI/SpeechIOForUnity/tree/master/NSSpeechForUnity" target="_blank">NSSpeechForUnity</a>として、<code>NSSpeechRecognizer</code>を呼び出す<code>Objective-C</code>コードを書き、外部ライブラリとして<code>.bundle</code>ファイルを書き出し、それをUnityのPluginとすることで実行しています。</p>

<h3 id="windows側">Windows側</h3>

<p>逆にWindows側では<code>UnityEngine.Windows.Speech</code>なるモジュールがあり、音声認識に関してはUnityから直接実行できる一方、音声合成に関しては別途WindowsのネイティブAPI＝<a href="https://ja.wikipedia.org/wiki/Speech_Application_Programming_Interface" target="_blank">SAPI</a>を叩く必要がありました。コード内で別途<a href="https://github.com/HassoPlattnerInstituteHCI/SpeechIOForUnity/tree/master/WindowsVoiceProject" target="_blank">WindowsVoiceProject</a>として、Visual Studioから.dllをビルドできるプロジェクトを作り、その.dllをUnityのPluginにします。</p>

<hr />

<p>以上２つのOSに関して独自にライブラリを書き出すことによって実現しましたが、Unity上で非同期の動作を実現させるため、それぞれの処理がきちんと終わったかどうかを常に監視するためのコードを書く必要があります。たとえば<a href="https://github.com/HassoPlattnerInstituteHCI/SpeechIOForUnity/blob/0ac6cfe8b468f970524b6dc558d0656bf501322c/NSSpeechForUnity/NSSpeechForUnity/native.m#L75" target="_blank">このように</a>、内部のStateを逐一変えて、Unity側から監視することで、UnityのAsync/Awaitが進行するように若干HardCodedな感じではありますが、リアルタイムアプリケーションのための非同期処理を実現しています。</p>

<hr />

<h2 id="応用">応用</h2>

<p>対話型アプリケーションのためとは言いましたが、VRアプリケーションなどのための目と手が離せない際のデバッグ（イベントが起こったときにどのフラグが立ったか喋って教えてくれる）や、視覚障害者向けアプリなど、様々な用途が考えられます。「デバッグのときになにか喋ってくれたら便利だな」とか、「アクセシビリティ機能の充実したアプリを作りたいな」などというときにはぜひ使ってみてください。</p>

</div>
<br><br>



<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n"
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb"
    crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn"
    crossorigin="anonymous"></script>
<script src="https://jotaros.github.io/js/custom.js"></script>
<script src="https://jotaros.github.io/js/tilt.jquery.js"></script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  displayIndent: "2em",
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  },
  "HTML-CSS": {
    availableFonts: [],
    webFont: "Neo-Euler",
    mtextFontInherit: true,
    matchFontHeight: false,
    scale:110
  }
});
</script>
<script type="text/javascript"
src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">
</script>

<p id="footer-copyright" align="right">Jotaro Shigeyama, 2019, All Right Reserved.</p>
</div>
</body>

</html>
